using HybridWebApp.Framework.IO;
using Microsoft.VisualStudio.TestPlatform.UnitTestFramework;
using System;
using System.Collections.Generic;
using System.IO;
using System.Linq;
using System.Reflection;
using System.Text;
using System.Threading.Tasks;
using HybridWebApp.Toolkit.Imaging;

namespace HybridWebApp.Framework.Test.Tests
{
    [TestClass]
    public class ImagingTests
    {
        [TestMethod]
        public async Task Images_Are_Converted_Correctly_To_DataURIs()
        {
            var expected = "data:image/png;base64,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";

            var folder = await Windows.ApplicationModel.Package.Current.InstalledLocation.GetFolderAsync("TestData");
            var file = await folder.GetFileAsync("img.png");

            var randomAccessFile = await file.OpenReadAsync();
            var actual = await randomAccessFile.ToDataUriAsync(file.FileType.TrimStart('.'));

            Assert.AreEqual(expected, actual);
        }
    }
}
